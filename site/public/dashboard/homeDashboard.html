<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/LogoSemFundo.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST | Dashboard</title>

    <link rel="stylesheet" href="../css/homeDashboard.css">
    <!-- <script src="../js/funcoes.js"></script> -->
    <!-- <script src="../js/cadastro_funcionario.js"></script> -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--FONT AWESOME-->
    <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>
</head>

<body>

    <!-- INICIANDO NAVBAR SUPERIOR -->
    <div class="nav-bar">
        <div class="container-nav-bar">
            <img src="../assets/icon/LogoSemFundo.png" alt="">

            <ul class="navbar">
                <li class="agora">
                    <a href="index.html">DASHBOARD</a>
                </li>
                <li>
                    <div class="">
                        <a href="../index.html">SAIR</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <div class="janela">

        <!-- INICIANDO NAV-BAR LATERAL -->
        <div class="header-left">

            <!-- DADOS DO USUÁRIO -->
            <div class="hello">
                <img src="../Imagens/icon_user.png" alt="">
                <div class="text-hello">
                    <h3><span id="b_usuario">usuário</span></h3>
                    <h4><span id="c_usuario">Nível de permissão</span></h4>
                </div>
            </div>

            <div class="container-server">
                <!-- botão home -->
                <a href="./homeDashboard.html">
                    <div class="btn-nav-current">
                        <img class="img_icon" src="../Imagens/icon-casa-preto.png" alt="">
                        <h3 style="margin-bottom: 11px;">Home</h3>
                    </div>
                </a>
                <br>

                <div class="btn-nav-server">
                    <img class="img_icon" src="../Imagens/icon-lupa-cinza.png" alt="">
                    <a href="./dashboard.html">
                        <h3>Monitorando</h3>
                    </a>
                </div>
                <br>
            </div>

            <!-- botão Individual Brudney -->
            <a href="./Individual/brudney.html">
                <div class="btn-nav">
                    <img class="img_icon" src="../../Imagens/icons8-wi-fi-26.png" alt="">
                    <h3>Rede</h3>
                </div>
            </a>

            <!-- botão equipe -->
            <a href="./equipe.html">
                <div class="btn-nav">
                    <img class="img_icon" src="../Imagens/icon-equipe-cinza.png" alt="">
                    <h3>Equipe</h3>
                </div>
            </a>

            <!-- Botão servidores -->
            <a href="./servidores.html">
                <div class="btn-nav">
                    <img class="img_icon" src="../Imagens/icon-servidor-cinza.png" alt="">

                    <h3>Servidores</h3>
                </div>
            </a>

            <!-- botão suporte -->
            <a href="#">
                <div class="btn-nav">
                    <img class="img_icon" src="../Imagens/icon-suporte-cinza.png" alt="">
                    <h3>Suporte</h3>
                </div>
            </a>

        </div>

        <!-- INICIANDO CADASRO DE EQUIPE -->

        <div class="dash">

            <!-- REGUA DE MÉTRICAS -->
            <div class="regua">

                <div class="item-regua ideal">
                    <h1>Ideal</h1>
                    <h4>CPU - < 50% </h4>
                            <h4>RAM - < 60% </h4>
                                    <h4>Disco - < 60%</h4>
                </div>

                <div class="item-regua alerta">
                    <h1>Alerta</h1>
                    <h4>CPU - 50% a 80%</h4>
                    <h4>RAM - 60% a 80%</h4>
                    <h4>Disco - 60% a 80%</h4>
                </div>

                <div class="item-regua perigo">
                    <h1>Perigo</h1>
                    <h4>CPU - > 80%</h4>
                    <h4>RAM - > 80%</h4>
                    <h4>Disco - > 80%</h4>
                </div>

            </div>

            <div class="card-geral">

                <input id="input_periodo1" type="datetime-local">
                <input id="input_periodo2" type="datetime-local">
                <button onclick="buscarCapturas()">Buscar capturas</button>

                <table style="width:100%">

                    <thead>
                        <tr>
                            <th>ID Servidor</th>
                            <th>CPU</th>
                            <th>RAM</th>
                            <th>DISCO</th>
                            <th>Pacotes Enviados</th>
                            <th>Pacotes Recebidos</th>
                            <th>Data Hora</th>
                        </tr>
                    <tbody id="body_historico">
                    </tbody>
                </table>
            </div>

        </div>


</body>

</html>

<script>

    var nivel_acesso = sessionStorage.NIVEL_ACESSO;

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    if (nivel_acesso == 3) {
        c_usuario.innerHTML = "Administrador"
    }
    if (nivel_acesso == 2) {
        c_usuario.innerHTML = "Visualizador e Editor";

        var equipeDiv = document.querySelector(".btn-nav img[src*='icon-equipe-cinza.png']").parentElement;
        if (equipeDiv) {
            equipeDiv.style.display = "none";
        }
    }

    if (nivel_acesso == 1) {
        c_usuario.innerHTML = "Visualizador";

        // Ocultar a div do botão "Equipe"
        var equipeDiv = document.querySelector(".btn-nav img[src*='icon-equipe-cinza.png']").parentElement;
        if (equipeDiv) {
            equipeDiv.style.display = "none";
        }

        // Ocultar a div do botão "Servidores"
        var servidoresDiv = document.querySelector(".btn-nav img[src*='icon-servidor-cinza.png']").parentElement;
        if (servidoresDiv) {
            servidoresDiv.style.display = "none";
        }
    }

    function buscarCapturas() {
        var feed = document.getElementById("body_historico");
        feed.innerHTML = ""

        var periodo1 = input_periodo1.value
        console.log(periodo1)
        var periodo2 = input_periodo2.value
        console.log(periodo2)
        var fk_instituicao = sessionStorage.FK_INSTITUICAO
        console.log(fk_instituicao)

        fetch(`/medidas/buscarCapturas/`, {

            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },

            body: JSON.stringify({
                periodo1Server: periodo1,
                periodo2Server: periodo2,
                fk_instituicaoServer: fk_instituicao

            })

        }).then(function (resposta) {

            console.log("resposta: ", resposta);
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var feed = document.getElementById("body_historico");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    feed.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var feed = document.getElementById("body_historico");
                    feed.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var dado = resposta[i];

                        // Cria uma nova linha na tabela
                        var novaLinha = feed.insertRow();

                        // <th>ID Servidor</th>
                        //     <th>CPU</th>
                        //     <th>RAM</th>
                        //     <th>DISCO</th>
                        //     <th>Pacotes Enviados</th>
                        //     <th>Pacotes Recebidos</th>
                        //     <th>Data Hora</th>

                        // Cria células para cada coluna
                        var id_servidor = novaLinha.insertCell(0);
                        var CPU = novaLinha.insertCell(1);
                        var RAM = novaLinha.insertCell(2);
                        var DISCO = novaLinha.insertCell(3);
                        var pacote_env = novaLinha.insertCell(4);
                        var pacote_rec = novaLinha.insertCell(5);
                        var data_hora = novaLinha.insertCell(6);
                        
                        if(dado.CPU == null){
                            CPU.innerHTML = "Não há dados para esse momento"
                        } else{
                            CPU.innerHTML = dado.CPU
                        } 
                        
                        if(dado.RAM == null){
                            RAM.innerHTML = "Não há dados para esse momento"
                        } else{
                            RAM.innerHTML = dado.RAM
                        } 
                        
                        if(dado.DISCO == null){
                            DISCO.innerHTML = "Não há dados para esse momento"
                        } else{
                            DISCO.innerHTML = dado.DISCO
                        }
                        
                        if(dado.PACOTES_ENVIADOS == null){
                            pacote_env.innerHTML = "Não há dados para esse momento"
                        } else{
                            pacote_env.innerHTML = dado.PACOTES_ENVIADOS
                        }
                        
                        if(dado.PACOTES_RECEBIDOS == null){
                            pacote_rec.innerHTML = "Não há dados para esse momento"
                        } else{
                            pacote_rec.innerHTML = dado.PACOTES_RECEBIDOS
                        }

                        id_servidor.innerHTML = dado.idServidor;
                        data_hora.innerHTML = dado.dataHora;

                    }

                    // finalizarAguardar();
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
            // finalizarAguardar();
        });
    }

</script>